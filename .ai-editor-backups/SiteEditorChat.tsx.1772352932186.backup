"use client";

import { useState, useRef, useEffect, useCallback } from "react";
import { useQuery } from "convex/react";
import { api } from "@/convex/_generated/api";
import { Card } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Textarea } from "@/components/ui/textarea";
import { ScrollArea } from "@/components/ui/scroll-area";
import { Badge } from "@/components/ui/badge";
import { usePlanFeatures } from "@/hooks/usePlanFeatures";
import { useSubscription } from "@/hooks/useSubscription";
import {
  Send,
  Loader2,
  Sparkles,
  Code2,
  Palette,
  Layout,
  Zap,
  History,
  AlertCircle,
  Crown,
  Undo2,
  CheckCircle2,
  FileCode2,
  RefreshCw,
} from "lucide-react";
import { toast } from "sonner";
import { useTranslation } from "react-i18next";

// â”€â”€â”€ Types â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

interface AppliedFile {
  filePath: string;
  timestamp: number;
  description: string;
}

interface Message {
  role: "user" | "assistant" | "system";
  content: string;
  editType?: "design" | "content" | "layout" | "logic" | "full_control";
  timestamp: number;
  appliedFiles?: AppliedFile[];
}

interface BackupMeta {
  originalPath: string;
  timestamp: number;
  description: string;
}

interface SiteEditorChatProps {
  userId: string;
  organizationId: string;
}

// â”€â”€â”€ Icon helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function getEditTypeIcon(type?: string) {
  switch (type) {
    case "design":      return <Palette className="h-3 w-3" />;
    case "content":     return <Code2 className="h-3 w-3" />;
    case "layout":      return <Layout className="h-3 w-3" />;
    case "logic":       return <Zap className="h-3 w-3" />;
    case "full_control": return <Crown className="h-3 w-3" />;
    default:            return null;
  }
}

// â”€â”€â”€ Component â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

export function SiteEditorChat({ userId, organizationId }: SiteEditorChatProps) {
  const { t } = useTranslation();

  const [messages, setMessages] = useState<Message[]>([
    {
      role: "system",
      content: t("aiSiteEditor.greeting"),
      timestamp: Date.now(),
    },
  ]);
  const [input, setInput] = useState("");
  const [isLoading, setIsLoading] = useState(false);
  const [rollingBack, setRollingBack] = useState<string | null>(null); // "filePath:timestamp"
  const [backups, setBackups] = useState<BackupMeta[]>([]);
  const [showBackups, setShowBackups] = useState(false);

  const scrollRef = useRef<HTMLDivElement>(null);
  const { features, plan } = usePlanFeatures();
  const { isActive } = useSubscription();

  const usage = useQuery(api.aiSiteEditor.getCurrentMonthUsage, {
    userId: userId as any,
    organizationId: organizationId as any,
  });

  const history = useQuery(api.aiSiteEditor.getHistory, {
    userId: userId as any,
    limit: 10,
  });

  // Scroll to bottom on new messages
  useEffect(() => {
    if (scrollRef.current) {
      scrollRef.current.scrollTop = scrollRef.current.scrollHeight;
    }
  }, [messages]);

  // Fetch backups list
  const fetchBackups = useCallback(async () => {
    try {
      const res = await fetch("/api/ai-site-editor/apply");
      if (res.ok) {
        const data = await res.json();
        setBackups(data.backups || []);
      }
    } catch {
      // silent
    }
  }, []);

  useEffect(() => {
    fetchBackups();
  }, [fetchBackups]);

  // â”€â”€â”€ Send message â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  const handleSend = async () => {
    if (!input.trim() || isLoading) return;

    const userMessage: Message = {
      role: "user",
      content: input,
      timestamp: Date.now(),
    };

    setMessages((prev) => [...prev, userMessage]);
    const currentInput = input;
    setInput("");
    setIsLoading(true);

    // Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¿Ğ»ĞµĞ¹ÑÑ…Ğ¾Ğ»Ğ´ĞµÑ€ Â«Ğ´ÑƒĞ¼Ğ°ĞµÑ‚...Â»
    setMessages((prev) => [
      ...prev,
      {
        role: "assistant",
        content: "",
        timestamp: Date.now(),
      },
    ]);

    try {
      const response = await fetch("/api/ai-site-editor", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          message: currentInput,
          userId,
          organizationId,
          plan,
        }),
      });

      if (!response.ok) {
        const error = await response.json();
        setMessages((prev) => prev.slice(0, -1));

        if (error.limitReached) {
          toast.error(error.error, {
            action: {
              label: t("aiSiteEditor.upgradePlan"),
              onClick: () => (window.location.href = "/settings?tab=billing"),
            },
          });
          setMessages((prev) => [
            ...prev,
            {
              role: "system",
              content: `âš ï¸ ${error.error}`,
              timestamp: Date.now(),
            },
          ]);
          return;
        }
        throw new Error(error.error || "Server error");
      }

      // ĞŸĞ°Ñ€ÑĞ¸Ğ¼ JSON Ğ¾Ñ‚Ğ²ĞµÑ‚
      const data = await response.json();
      const { response: aiText, appliedFiles, editType } = data;

      // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ÑĞ¾Ğ¾Ğ±Ñ‰ĞµĞ½Ğ¸Ğµ Ñ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ¾Ğ¼
      setMessages((prev) => {
        const updated = [...prev];
        updated[updated.length - 1] = {
          role: "assistant",
          content: aiText,
          editType,
          timestamp: Date.now(),
        };
        return updated;
      });

      // ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµĞ¼ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚
      if (appliedFiles && appliedFiles.length > 0) {
        toast.success(`âœ… ĞŸÑ€Ğ¸Ğ¼ĞµĞ½ĞµĞ½Ğ¾ ${appliedFiles.length} Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹! Ğ¤Ğ°Ğ¹Ğ»Ñ‹ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ñ‹.`, { duration: 5000 });
        console.log('Applied files:', appliedFiles);
      } else {
        toast.info("AI Ğ¾Ñ‚Ğ²ĞµÑ‚Ğ¸Ğ», Ğ½Ğ¾ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ½Ğµ Ğ±Ñ‹Ğ»Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ñ‹", { duration: 3000 });
      }

      // ĞĞ±Ğ½Ğ¾Ğ²Ğ»ÑĞµĞ¼ ÑĞ¿Ğ¸ÑĞ¾Ğº backup'Ğ¾Ğ²
      fetchBackups();
    } catch (error) {
      console.error("Error:", error);
      setMessages((prev) => {
        const updated = [...prev];
        updated[updated.length - 1] = {
          role: "system",
          content: `âŒ ${t("aiSiteEditor.error")}`,
          timestamp: Date.now(),
        };
        return updated;
      });
      toast.error(t("aiSiteEditor.error"));
    } finally {
      setIsLoading(false);
    }
  };

  // â”€â”€â”€ Rollback â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  const handleRollback = async (filePath: string, timestamp: number) => {
    const key = `${filePath}:${timestamp}`;
    setRollingBack(key);

    try {
      const res = await fetch("/api/ai-site-editor/apply", {
        method: "DELETE",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ filePath, timestamp }),
      });

      const data = await res.json();

      if (res.ok && data.success) {
        toast.success(`â†©ï¸ ĞÑ‚ĞºĞ°Ñ‚ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½: ${filePath}`);
        fetchBackups();
        setMessages((prev) => [
          ...prev,
          {
            role: "system",
            content: `â†©ï¸ ĞÑ‚ĞºĞ°Ñ‚ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½ Ğ´Ğ»Ñ Ñ„Ğ°Ğ¹Ğ»Ğ° ${filePath}`,
            timestamp: Date.now(),
          },
        ]);
      } else {
        toast.error(`ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¾Ñ‚ĞºĞ°Ñ‚Ğ°: ${data.error || "ĞĞµĞ¸Ğ·Ğ²ĞµÑÑ‚Ğ½Ğ°Ñ Ğ¾ÑˆĞ¸Ğ±ĞºĞ°"}`);
      }
    } catch {
      toast.error("ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ğ¸ Ğ¾Ñ‚ĞºĞ°Ñ‚Ğ°");
    } finally {
      setRollingBack(null);
    }
  };

  // â”€â”€â”€ Render helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  const getEditTypeLabel = (type?: string) => {
    switch (type) {
      case "design":      return t("aiSiteEditor.design");
      case "content":     return t("aiSiteEditor.content");
      case "layout":      return t("aiSiteEditor.layout");
      case "logic":       return t("aiSiteEditor.logic");
      case "full_control": return t("aiSiteEditor.fullControl");
      default:            return "";
    }
  };

  const isProfessionalOrHigher = plan === "professional" || plan === "enterprise";

  // â”€â”€â”€ JSX â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

  return (
    <div className="flex flex-col h-full space-y-4">

      {/* Usage Stats â€” Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ starter */}
      {!isProfessionalOrHigher && usage && (
        <Card className="p-4 bg-gradient-to-r from-amber-50/20 to-orange-50/20 dark:from-amber-950/10 dark:to-orange-950/10 border-amber-200/30 dark:border-amber-900/20">
          <div className="flex items-start gap-3">
            <AlertCircle className="h-5 w-5 text-amber-500 dark:text-amber-600 mt-0.5" />
            <div className="flex-1">
              <h4 className="font-semibold text-amber-900 dark:text-amber-100 mb-2">
                {t("aiSiteEditor.usageThisMonth")}
              </h4>
              <div className="grid grid-cols-3 gap-4 text-sm">
                <div>
                  <div className="text-amber-700 dark:text-amber-300">{t("aiSiteEditor.design")}</div>
                  <div className="font-semibold text-amber-900 dark:text-amber-100">
                    {usage.designChanges} / {features.aiSiteEditorDesignChanges}
                  </div>
                </div>
                <div>
                  <div className="text-amber-700 dark:text-amber-300">{t("aiSiteEditor.content")}</div>
                  <div className="font-semibold text-amber-900 dark:text-amber-100">
                    {usage.contentChanges} / {features.aiSiteEditorContentChanges}
                  </div>
                </div>
                <div>
                  <div className="text-amber-700 dark:text-amber-300">{t("aiSiteEditor.layout")}</div>
                  <div className="font-semibold text-amber-900 dark:text-amber-100">
                    {usage.layoutChanges} / {features.aiSiteEditorLayoutChanges}
                  </div>
                </div>
              </div>
              <Button
                variant="outline"
                size="sm"
                className="mt-3 border-amber-300 dark:border-amber-700"
                onClick={() => (window.location.href = "/settings?tab=billing")}
              >
                <Crown className="h-4 w-4 mr-2" />
                {t("aiSiteEditor.upgradeForUnlimited")}
              </Button>
            </div>
          </div>
        </Card>
      )}

      {/* Professional/Enterprise badge */}
      {isProfessionalOrHigher && (
        <Card className="p-4 bg-gradient-to-r from-purple-900/10 to-blue-900/10 dark:from-purple-50/20 dark:to-blue-50/20 border-purple-700/30 dark:border-purple-300/20">
          <div className="flex items-center gap-3">
            <Crown className="h-5 w-5 text-purple-600 dark:text-purple-400" />
            <div>
              <h4 className="font-semibold text-purple-900 dark:text-purple-100">
                {plan === "professional" ? t("aiSiteEditor.professionalPlan") : t("aiSiteEditor.enterprisePlan")}
              </h4>
              <p className="text-sm text-purple-700 dark:text-purple-300">
                âœ¨ {t("aiSiteEditor.unlimited")} Â· AI Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ÑĞµÑ‚ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñ Ğ² Ñ„Ğ°Ğ¹Ğ»Ñ‹
              </p>
            </div>
          </div>
        </Card>
      )}

      {/* Chat Messages */}
      <Card className="flex-1 flex flex-col min-h-0">
        <ScrollArea className="flex-1 p-4" ref={scrollRef}>
          <div className="space-y-4">
            {messages.map((msg, idx) => (
              <div
                key={idx}
                className={`flex ${msg.role === "user" ? "justify-end" : "justify-start"}`}
              >
                <div
                  className={`max-w-[85%] rounded-lg p-4 ${
                    msg.role === "user"
                      ? "bg-primary text-primary-foreground"
                      : msg.role === "system"
                      ? "bg-muted text-muted-foreground"
                      : "bg-secondary text-secondary-foreground"
                  }`}
                >
                  {/* Edit type badge */}
                  {msg.editType && (
                    <Badge variant="outline" className="mb-2">
                      {getEditTypeIcon(msg.editType)}
                      <span className="ml-1">{getEditTypeLabel(msg.editType)}</span>
                    </Badge>
                  )}

                  {/* Message content */}
                  <div className="whitespace-pre-wrap text-sm leading-relaxed">
                    {msg.content || (
                      <span className="flex items-center gap-2 text-muted-foreground">
                        <Loader2 className="h-4 w-4 animate-spin" />
                        AI Ñ‡Ğ¸Ñ‚Ğ°ĞµÑ‚ Ñ„Ğ°Ğ¹Ğ»Ñ‹ Ğ¸ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ÑĞµÑ‚ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñâ€¦
                      </span>
                    )}
                  </div>

                  {/* Applied files list with per-file rollback */}
                  {msg.appliedFiles && msg.appliedFiles.length > 0 && (
                    <div className="mt-3 space-y-1 border-t pt-3">
                      <p className="text-xs font-medium text-muted-foreground mb-1">
                        ğŸ“‚ Ğ˜Ğ·Ğ¼ĞµĞ½Ñ‘Ğ½Ğ½Ñ‹Ğµ Ñ„Ğ°Ğ¹Ğ»Ñ‹:
                      </p>
                      {msg.appliedFiles.map((af) => {
                        const key = `${af.filePath}:${af.timestamp}`;
                        const isRollingThisBack = rollingBack === key;
                        return (
                          <div
                            key={key}
                            className="flex items-center justify-between gap-2 rounded bg-background/50 px-2 py-1"
                          >
                            <div className="flex items-center gap-1.5 min-w-0">
                              <FileCode2 className="h-3 w-3 shrink-0 text-green-500" />
                              <span className="text-xs truncate font-mono">
                                {af.filePath}
                              </span>
                            </div>
                            <Button
                              variant="ghost"
                              size="sm"
                              className="h-6 px-2 shrink-0 text-xs"
                              disabled={isRollingThisBack}
                              onClick={() => handleRollback(af.filePath, af.timestamp)}
                            >
                              {isRollingThisBack ? (
                                <Loader2 className="h-3 w-3 animate-spin" />
                              ) : (
                                <>
                                  <Undo2 className="h-3 w-3 mr-1" />
                                  ĞÑ‚ĞºĞ°Ñ‚
                                </>
                              )}
                            </Button>
                          </div>
                        );
                      })}
                    </div>
                  )}
                </div>
              </div>
            ))}

            {/* Global loading indicator */}
            {isLoading && messages[messages.length - 1]?.content === "" && (
              <div className="flex justify-start">
                <div className="bg-secondary text-secondary-foreground rounded-lg p-4">
                  <div className="flex items-center gap-2 text-sm text-muted-foreground">
                    <Sparkles className="h-4 w-4 animate-pulse text-purple-500" />
                    AI Ñ‡Ğ¸Ñ‚Ğ°ĞµÑ‚ ĞºĞ¾Ğ´ Ğ¸ Ğ¿Ñ€Ğ¸Ğ¼ĞµĞ½ÑĞµÑ‚ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ñâ€¦
                  </div>
                </div>
              </div>
            )}
          </div>
        </ScrollArea>

        {/* Input area */}
        <div className="p-4 border-t">
          <div className="flex gap-2">
            <Textarea
              value={input}
              onChange={(e) => setInput(e.target.value)}
              onKeyDown={(e) => {
                if (e.key === "Enter" && !e.shiftKey) {
                  e.preventDefault();
                  handleSend();
                }
              }}
              placeholder={t("aiSiteEditor.inputPlaceholder")}
              className="min-h-[60px] resize-none"
              disabled={isLoading}
            />
            <Button
              onClick={handleSend}
              disabled={!input.trim() || isLoading}
              size="icon"
              className="h-[60px] w-[60px]"
            >
              {isLoading ? (
                <Loader2 className="h-5 w-5 animate-spin" />
              ) : (
                <Send className="h-5 w-5" />
              )}
            </Button>
          </div>
        </div>
      </Card>

      {/* Backup / Rollback panel */}
      {backups.length > 0 && (
        <Card className="p-4">
          <div className="flex items-center justify-between mb-3">
            <h3 className="font-semibold flex items-center gap-2 text-sm">
              <History className="h-4 w-4" />
              Ğ˜ÑÑ‚Ğ¾Ñ€Ğ¸Ñ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¹ ({backups.length} backup-Ğ¾Ğ²)
            </h3>
            <Button
              variant="ghost"
              size="sm"
              onClick={() => {
                setShowBackups((v) => !v);
                fetchBackups();
              }}
            >
              <RefreshCw className="h-3 w-3 mr-1" />
              {showBackups ? "Ğ¡ĞºÑ€Ñ‹Ñ‚ÑŒ" : "ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ"}
            </Button>
          </div>

          {showBackups && (
            <div className="space-y-2 max-h-48 overflow-y-auto">
              {backups.slice(0, 20).map((b) => {
                const key = `${b.originalPath}:${b.timestamp}`;
                const isRollingThisBack = rollingBack === key;
                return (
                  <div
                    key={key}
                    className="flex items-center justify-between gap-2 text-sm p-2 rounded hover:bg-muted/50 transition-colors"
                  >
                    <div className="min-w-0 flex-1">
                      <div className="flex items-center gap-1.5">
                        <FileCode2 className="h-3 w-3 shrink-0 text-blue-500" />
                        <span className="font-mono text-xs truncate">{b.originalPath}</span>
                      </div>
                      <div className="text-xs text-muted-foreground mt-0.5">
                        {new Date(b.timestamp).toLocaleString("ru-RU")} Â· {b.description}
                      </div>
                    </div>
                    <Button
                      variant="outline"
                      size="sm"
                      className="h-7 shrink-0"
                      disabled={isRollingThisBack}
                      onClick={() => handleRollback(b.originalPath, b.timestamp)}
                    >
                      {isRollingThisBack ? (
                        <Loader2 className="h-3 w-3 animate-spin" />
                      ) : (
                        <>
                          <Undo2 className="h-3 w-3 mr-1" />
                          ĞÑ‚ĞºĞ°Ñ‚
                        </>
                      )}
                    </Button>
                  </div>
                );
              })}
            </div>
          )}
        </Card>
      )}

      {/* Recent session history */}
      {history && history.length > 0 && (
        <Card className="p-4">
          <h3 className="font-semibold mb-3 flex items-center gap-2 text-sm">
            <History className="h-4 w-4" />
            {t("aiSiteEditor.recentChanges")}
          </h3>
          <div className="space-y-2">
            {history.slice(0, 5).map((session) => (
              <div
                key={session._id}
                className="flex items-center justify-between text-sm p-2 rounded hover:bg-muted/50 transition-colors"
              >
                <div className="flex items-center gap-2 flex-1 min-w-0">
                  {getEditTypeIcon(session.editType)}
                  <span className="text-muted-foreground truncate">
                    {session.userMessage.substring(0, 60)}
                    {session.userMessage.length > 60 ? "â€¦" : ""}
                  </span>
                </div>
                {session.status === "completed" && (
                  <CheckCircle2 className="h-4 w-4 text-green-500 shrink-0" />
                )}
              </div>
            ))}
          </div>
        </Card>
      )}
    </div>
  );
}
