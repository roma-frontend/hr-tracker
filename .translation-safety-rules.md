# üîí Translation Safety Rules

**CRITICAL: Follow these rules to prevent data loss!**

---

## ‚ùå NEVER DO THIS:

### 1. PowerShell ConvertTo-Json
```powershell
# ‚ùå THIS WILL CORRUPT UNICODE!
$json | ConvertTo-Json -Depth 100 | Out-File file.json
```

**Why:** PowerShell's `ConvertTo-Json` mangles Cyrillic and Armenian characters into gibberish.

---

### 2. Direct File Editing without Backup
```powershell
# ‚ùå DON'T EDIT JSON FILES DIRECTLY IN POWERSHELL
Set-Content "ru.json" $content
```

---

## ‚úÖ ALWAYS DO THIS:

### 1. Use Node.js for JSON Operations
```javascript
// ‚úÖ SAFE - Preserves Unicode
const fs = require('fs');
fs.writeFileSync('file.json', JSON.stringify(data, null, 2), 'utf8');
```

### 2. Run Tests Before Committing
```bash
node scripts/test-translations.js
```

**Expected:** All 27 tests should pass

### 3. Commit After Every Translation Session
```bash
git add src/i18n/locales/*.json
git commit -m "feat: updated translations"
```

### 4. Use Recovery Script if Corruption Happens
```bash
node scripts/fix-unicode-translations.js
```

This will restore Russian/Armenian from git history.

---

## üõ°Ô∏è Safety Checklist

Before modifying translations:

- [ ] Is this via Node.js script? ‚úÖ
- [ ] Have I committed recent work? ‚úÖ
- [ ] Do I have a backup plan? ‚úÖ

After modifying translations:

- [ ] Run tests: `node scripts/test-translations.js` ‚úÖ
- [ ] Check Unicode in browser (switch to RU/HY) ‚úÖ
- [ ] Commit immediately ‚úÖ

---

## üö® If Unicode Gets Corrupted:

### Step 1: Don't Panic
Translation backups exist in:
- Git history
- `.translation-backups/` folder

### Step 2: Restore from Git
```bash
node scripts/fix-unicode-translations.js
```

This automatically:
1. Fetches last good version from git
2. Removes BOM
3. Preserves Unicode
4. Merges with current English structure

### Step 3: Verify
```bash
node scripts/test-translations.js
```

All tests should pass.

### Step 4: Commit
```bash
git add src/i18n/locales/*.json
git commit -m "fix: restored Unicode translations"
```

---

## üìã Quick Reference

### Safe Operations
| Operation | Tool | Command |
|-----------|------|---------|
| Read JSON | Node.js | `JSON.parse(fs.readFileSync(path, 'utf8'))` |
| Write JSON | Node.js | `fs.writeFileSync(path, JSON.stringify(data, null, 2), 'utf8')` |
| Test | Node.js | `node scripts/test-translations.js` |
| Fix Unicode | Node.js | `node scripts/fix-unicode-translations.js` |
| Backup | Git | `git commit -am "backup translations"` |

### Unsafe Operations (AVOID!)
| Operation | Tool | Why Dangerous |
|-----------|------|---------------|
| ConvertTo-Json | PowerShell | Corrupts Unicode |
| Out-File | PowerShell | Adds BOM |
| Set-Content | PowerShell | Encoding issues |
| Manual editing | Any | Human error |

---

## üéØ Current Status

Last verified: March 1, 2026

- ‚úÖ Russian: 253 keys translated, 914 English fallback (22%)
- ‚úÖ Armenian: 253 keys translated, 914 English fallback (22%)
- ‚úÖ All tests passing (27/27)
- ‚úÖ Unicode verified working

---

## üìû Emergency Contact

If translations are lost and you can't restore:

1. Check git history: `git log -- src/i18n/locales/`
2. Run recovery script: `node scripts/fix-unicode-translations.js`
3. Check backups: `.translation-backups/`
4. Last resort: Restore from this commit: `2e637c5`

---

**Remember:** Node.js good, PowerShell bad (for Unicode JSON) üõ°Ô∏è
